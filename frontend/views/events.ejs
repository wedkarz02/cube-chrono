<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wydarzenia - Cube Chrono</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1>Wydarzenia</h1>
        <div class="auth-links">
            <a href="/">Strona Główna</a>
            <a href="/login">Zaloguj się</a>
        </div>
    </header>

    <main>
        <section>
            <h2>Oficjalne Wydarzenia</h2>
            <p>Lista wydarzeń organizowanych przez moderatorów.</p>
            <ul class="event-list">
                <% if (eventsList !== null) { %>
                <li>
                    <h3>Mistrzostwa Polski 2024</h3>
                    <p>Data: 15.07.2024</p>
                    <p>Lokalizacja: Warszawa</p>
                    <button>Dołącz</button>
                </li>
                <% } else { %>
                <li>
                    <h3>Speedcubing Open</h3>
                    <p>Data: 05.08.2024</p>
                    <p>Lokalizacja: Kraków</p>
                    <button>Dołącz</button>
                </li>
                <% } %>
            </ul>
        </section>        

        <section>
            <h2>Prywatne Wydarzenia</h2>
            <p>Wydarzenia dostępne tylko dla zaproszonych użytkowników.</p>
            <ul class="event-list">
                <li>
                    <h3>Trening dla Znajomych</h3>
                    <p>Data: 20.06.2024</p>
                    <p>Lokalizacja: Online</p>
                    <button>Zaakceptuj Zaproszenie</button>
                </li>
            </ul>
        </section>

        <section class="create-event">
            <h2>Utwórz Wydarzenie</h2>
            <form action="#" method="POST" class="form" id="eventCreate-form">
                <label for="event-title">Tytuł wydarzenia:</label>
                <input type="text" id="event-title" name="event-title" required>
            
                <label for="event-description">Opis wydarzenia:</label>
                <textarea id="event-description" name="event-description" required></textarea>
            
                <label for="event-start-time">Czas rozpoczęcia:</label>
                <input type="time" id="event-start-time" name="event-start-time" required>
            
                <label for="event-end-time">Czas zakończenia:</label>
                <input type="time" id="event-end-time" name="event-end-time" required>
            
                <label for="event-is-private">Czy wydarzenie jest prywatne?</label>
                <select id="event-is-private" name="event-is-private">
                    <option value="true">Tak</option>
                    <option value="false">Nie</option>
                </select>
            
                <button type="submit">Utwórz Wydarzenie</button>
            </form>
            
        </section>
    </main>

    <footer>
        <p>&copy; 2024 Cube Chrono. Wszystkie prawa zastrzeżone.</p>
    </footer>

    <script src="script.js"></script>
    <script>
        document.getElementById('eventCreate-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
        const eventTitle = document.getElementById('event-title').value;
        const eventDescription = document.getElementById('event-description').value;
        const eventStartTime = document.getElementById('event-start-time').value;
        const eventEndTime = document.getElementById('event-end-time').value;
        const eventIsPrivate = document.getElementById('event-is-private').value;

        const data = {
            title: eventTitle,
            description: eventDescription,
            start_time: eventStartTime,
            end_time: eventEndTime,
            is_private: eventIsPrivate
        };

            try {
                const response = await fetch('/api/v1/events', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                console.log(response);
                if (response.status == 201) {
                    alert(`Utworzono wydarzenie: ${eventTitle}`);
                } else {
                    alert('Błąd tworzenia wydarzenia!');
                }
                window.location.href = '/events';
            } catch (error) {
                console.error('Błąd połączenia:', error);
                alert('Wystąpił błąd połączenia z serwerem.');
            }
        });
    </script>
</body>
</html>