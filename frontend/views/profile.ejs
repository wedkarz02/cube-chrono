<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profil UÅ¼ytkownika - Cube Chrono</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1>ğŸ‘¤ Profil UÅ¼ytkownika <%= username %></h1>
        <div class="auth-links">
            <a href="/">Strona GÅ‚Ã³wna</a>
            <a href="/events">Wydarzenia</a>
            <form action="http://localhost:3000/logout" method="POST" style="display: inline;">
                <button type="submit" style="background: none; border: none; color: blue; text-decoration: underline; cursor: pointer;">Wyloguj siÄ™</button>
            </form>
        </div>
    </header>

    <main>
        <!-- Sekcja Informacji Profilowych -->
        <section class="profile-info">
            <h2>ğŸ“ Twoje Dane</h2>
            <form class="form change-password">
                <label for="old_password">Stare hasÅ‚o:</label>
                <input type="password" id="old_password">
            
                <label for="new_password">Nowe hasÅ‚o:</label>
                <input type="password" id="new_password">
                
                <button type="submit">ZmieÅ„ hasÅ‚o</button>
            </form>
            
            <form class="form change-username">
                <label for="username">Nazwa uÅ¼ytkownika:</label>
                <input type="text" id="username" value=<%= username %> required>
                
                <button type="submit">ZmieÅ„ nazwÄ™ uÅ¼ytkownika</button>
            </form>
        </section>

        <!-- Sekcja Historii WynikÃ³w -->
        <section class="profile-history">
            <h2>ğŸ“Š Historia WynikÃ³w</h2>
            <ul class="history-list">
                <li><strong>01.05.2024:</strong> 10.24s</li>
                <li><strong>28.04.2024:</strong> 11.32s</li>
                <li><strong>25.04.2024:</strong> 12.12s</li>
            </ul>
        </section>

        <section>
            <h2>ğŸ† Ranking</h2>
            <p>SprawdÅº swoje miejsce w rankingu.</p>
            <button onclick="window.location.href='ranking.html'">PrzejdÅº do Rankingu</button>
        </section>        

        <!-- Sekcja Moich WydarzeÅ„ -->
        <section class="profile-events">
            <h2>ğŸ—“ï¸ Moje Wydarzenia</h2>
            <ul class="events-list">
                <li>
                    <strong>Mistrzostwa Polski 2024</strong> - 15.07.2024
                    <span>Status: Zapisany</span>
                </li>
                <li>
                    <strong>Speedcubing Open</strong> - 05.08.2024
                    <span>Status: Zapisany</span>
                </li>
            </ul>
            <button onclick="window.location.href='/events'">PrzejdÅº do WydarzeÅ„</button>
        </section>
    </main>

    <footer>
        <p>&copy; 2024 Cube Chrono. Wszystkie prawa zastrzeÅ¼one.</p>
    </footer>

    <script>
        document.querySelector('.change-password').addEventListener('submit', async (e) => {
            e.preventDefault();
            const old_password = document.getElementById('old_password').value;
            const new_password = document.getElementById('new_password').value;
            const data = {
                new_password: new_password,
                old_password: old_password
            };

            try {
                const result = await fetch("/password", {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                const jsonResult = await result.json();

                if (result.status === 200) {
                    window.location.href = '/login';
                } else if (result.status === 400 || result.status === 401) {
                    alert(jsonResult.message || 'Dane sÄ… niepoprawne!');
                } else {
                    alert(jsonResult.message || 'BÅ‚Ä…d komunikacji z serwerem!');
                }
            } catch (error) {
                alert('BÅ‚Ä…d przy prÃ³bie poÅ‚Ä…czenia z serwerem.');
                console.error(error);
            }
        });

        document.querySelector('.change-username').addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const data = {
                username: username
            };

            try {
                const result = await fetch("/username", {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                if (result.status === 200) {
                    location.reload();
                    alert('Zmieniono nazwÄ™ uÅ¼ytkownika!');
                } else if (result.status === 400 || result.status === 401) {
                    alert(responseBody.message || 'Dane sÄ… niepoprawne!');
                } else {
                    alert(responseBody.message || 'BÅ‚Ä…d komunikacji z serwerem!');
                }
            } catch (error) {
                alert('BÅ‚Ä…d przy prÃ³bie poÅ‚Ä…czenia z serwerem.');
                console.error(error);
            }
        });
    </script>
</body>
</html>
